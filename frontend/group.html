<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tasks</title>
    <link rel="stylesheet" href="static/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-glass px-3">
    <a id="backBtn" class="navbar-brand text-white fw-bold" style="cursor:pointer">← Retour</a>

    <div class="ms-auto">
        <button class="btn btn-glass" onclick="logout()">Déconnexion</button>
    </div>
</nav>  

<script>
document.getElementById("backBtn").onclick = () => history.back();
</script>

<div class="container mt-4">

    <h1 id="groupName" class="page-title mb-4"></h1>

    <div class="card-glass mb-4">
        <h4>Créer une tâche</h4>

        <div class="input-group mt-3">
            <input id="taskTitle" class="form-control" placeholder="Titre de la tâche">
            <button class="btn btn-main" onclick="addTask()">Ajouter</button>
        </div>
    </div>

    <div class="card-glass">
        <h4>Tâches</h4>
        <ul id="taskList" class="list-group mt-3"></ul>
    </div>

</div>

<script src="static/app.js"></script>

<script>
// -----------------------
// Récupération du groupId
// -----------------------
const urlparams = new URLSearchParams(window.location.search);
const groupId = urlparams.get("id");

if (!groupId) {
    alert("Aucun groupe sélectionné !");
    window.location.href = "groups.html";
}

// -----------------------
// Charger les tâches
// -----------------------
async function loadGroup() {
    const tasks = await fetchGroupTasks(groupId);

    // Nom du groupe (temps réel si backend fournit le vrai titre)
    groupName.textContent = "Groupe #" + groupId;

    taskList.innerHTML = "";

    tasks.forEach(t => {
        taskList.innerHTML += `
            <li class="list-group-item bg-transparent text-white border-light">
                ${t.title}
            </li>
        `;
    });
}

// -----------------------
// Ajouter une tâche
// -----------------------
async function addTask() {
    const title = taskTitle.value.trim();

    if (!title) {
        alert("Entre un titre !");
        return;
    }

    await createTask(groupId, title);
    taskTitle.value = "";
    loadGroup();
}

// Charger au démarrage
loadGroup();
</script>

</body>
</html>
